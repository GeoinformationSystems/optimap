{% extends "main.html" %}
{% load optimap_extras %}
{% load humanize %}
{% block title %}Data & API | {% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-4 py-5 text-wrap">
    <h1 class="py-2">OPTIMAP Data & API Access</h1>
    <p class="lead">
      All publication metadata published in OPTIMAP is licensed under a Creative Commons Zero 
      (<a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CC-0</a>) license.
    </p>
    <h2 class="py-2">API Endpoint</h2>
    <p>
      The API endpoint is <b>{{ site|addstr:"/api"|urlize }}</b>. Visit the URL in your browser 
      to get an interactive interface for exploring the API.
    </p>
    <p>
      You can query all publications with the following request (using 
      <a href="https://stedolan.github.io/jq/" title="Link to jq project website" target="_blank"><code>jq</code></a> for formatting):
    </p>
    <pre>
curl -X GET {{ site|addstr:"/api" }}/api/optimap/ | jq
    </pre>
    <h2 class="py-2">OpenAPI Schema</h2>
    <p>
      You can download an OpenAPI specification of the API at <b>{{ site|addstr:"/api/schema"|urlize }}</b>.
    </p>
    <h2 class="py-2">OpenAPI User Interface</h2>
    <p>
      Explore the API with an interactive user interface built based on the OpenAPI schema at <b>{{ site|addstr:"/api/schema/ui"|urlize }}</b>.
    </p>
    <hr>
    <h2 class="py-2">Download Publication Data</h2>
    <p>
      Choose your desired file format.
    </p>
    <ul>
      <li class="text-nowrap">
        <a class="btn btn-primary" href="{% url 'optimap:download_geojson' %}">
          Download GeoJSON
        </a>
        <span class="text-nowrap">
          (<a href="https://geojson.org/" target="_blank">GeoJSON spec</a>) {{ geojson_size }}
        </span>
      </li>
      <li class="text-nowrap">
        <a class="btn btn-primary" href="{% url 'optimap:download_geopackage' %}">
          Download GeoPackage
        </a>
        <span class="text-nowrap">
          (<a href="https://www.geopackage.org/" target="_blank">GeoPackage spec</a>) {{ geopackage_size }}
        </span>
      </li>
    </ul>

    <p class="small text-muted">
      Data dumps are recreated every 6 hours. Last updated: {{ last_updated|naturaltime }}
    </p>    
  </div>
</div>
{% endblock %}
