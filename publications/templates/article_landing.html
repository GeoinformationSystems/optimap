{% extends "base.html" %} {# or "main.html" if that's your layout #}

{% block title %}{{ pub.title }} â€” OPTIMAP{% endblock %}

{% block content %}
  <h1 class="page-title">{{ pub.title }}</h1>

  <section class="meta">
    {% if pub.doi %}<div><strong>DOI:</strong> <a href="https://doi.org/{{ pub.doi }}">https://doi.org/{{ pub.doi }}</a></div>{% endif %}
    {% if pub.url %}<div><strong>Original URL:</strong> <a href="{{ pub.url }}">{{ pub.url }}</a></div>{% endif %}
    {% if pub.publicationDate %}<div><strong>Publication date:</strong> {{ pub.publicationDate }}</div>{% endif %}
    {% if pub.source %}<div><strong>Source:</strong> {{ pub.source.name }}</div>{% endif %}
  </section>

  {% if pub.abstract %}
    <h2>Abstract</h2>
    <p>{{ pub.abstract }}</p>
  {% endif %}

  {% if pub.geometry %}
    <h2>Location</h2>
    <div id="map" style="height:360px;border-radius:12px;margin:1rem 0;"></div>
  {% endif %}

  <p class="text-muted" style="margin-top:1rem;">
    If you notice incorrect information on this page, please email
    <a href="mailto:login@optimap.science">login@optimap.science</a>.
  </p>

  {% if pub.geometry %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      (function() {
        const map = L.map('map');
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          { attribution: '&copy; OpenStreetMap' }).addTo(map);
        const layer = L.geoJSON(JSON.parse('{{ pub.geometry.geojson|safe }}')).addTo(map);
        try { map.fitBounds(layer.getBounds(), { padding: [20,20] }); } catch (e) { map.setView([0,0], 2); }
      })();
    </script>
  {% endif %}
{% endblock %}
