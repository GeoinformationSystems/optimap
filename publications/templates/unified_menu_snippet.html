{% load static %}

<li class="nav-item dropdown">
  <a
    class="nav-link dropdown-toggle"
    href="#"
    id="unifiedMenuDropdown"
    role="button"
    data-toggle="dropdown"
    aria-expanded="false"
    aria-label="Main menu">
    <i class="fa-solid fa-bars fa-3x"></i>
  </a>
  <ul
    class="dropdown-menu dropdown-menu-right"
    aria-labelledby="unifiedMenuDropdown"
    style="min-width: 280px; margin-top: 1rem;">

    <!-- Main Navigation Section -->
    <li><a class="dropdown-item" href="/"><i class="fas fa-home"></i> Home</a></li>
    <li><a class="dropdown-item" href="{% url 'optimap:works' %}"><i class="fas fa-list"></i> Browse Works</a></li>
    <li><a class="dropdown-item" href="{% url 'optimap:contribute' %}"><i class="fas fa-hands-helping"></i> Contribute</a></li>
    <div class="dropdown-divider"></div>
    <li><a class="dropdown-item" href="{% url 'optimap:data' %}"><i class="fas fa-database"></i> Data & API</a></li>
    <li><a class="dropdown-item" href="{% url 'optimap:feeds' %}"><i class="fas fa-rss"></i> Feeds</a></li>
    <div class="dropdown-divider"></div>
    <li><a class="dropdown-item" href="{% url 'optimap:about' %}"><i class="fas fa-info-circle"></i> About</a></li>
    <li><a class="dropdown-item" href="{% url 'optimap:contact' %}"><i class="fas fa-envelope"></i> Contact</a></li>
    <li><a class="dropdown-item" href="{% url 'optimap:accessibility' %}"><i class="fas fa-universal-access"></i> Accessibility</a></li>
    <div class="dropdown-divider"></div>
    <li><a class="dropdown-item" href="https://github.com/GeoinformationSystems/optimap" target="_blank" rel="noopener"><i class="fas fa-code"></i> Code on GitHub</a></li>

    <!-- User Section (if authenticated) -->
    {% if request.user.is_authenticated %}
    <div class="dropdown-divider"></div>
    <li class="dropdown-header"><i class="fas fa-user"></i> User Account</li>
    <li><a class="dropdown-item disabled text-muted small" style="white-space: normal; cursor: default;">{{ user.email }}</a></li>
    <div class="dropdown-divider"></div>
    <li><a class="dropdown-item" href="{% url 'optimap:usersettings' %}"><i class="fas fa-cog"></i> Settings</a></li>
    <li><a class="dropdown-item" href="{% url 'optimap:subscriptions' %}"><i class="fas fa-bell"></i> Subscriptions</a></li>
    {% if user.is_superuser %}
    <div class="dropdown-divider"></div>
    <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i class="fas fa-user-shield"></i> Admin</a></li>
    {% endif %}
    <div class="dropdown-divider"></div>
    <li><a class="dropdown-item" href="{% url 'optimap:logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>

    <!-- Login Section (if not authenticated) -->
    {% else %}
    <div class="dropdown-divider"></div>
    <li class="dropdown-header"><i class="fas fa-sign-in-alt"></i> Login / Sign Up</li>
    <li class="px-3 py-2">
      <p class="small text-muted mb-2">
        <em>New around here?</em> Login is password-less. Enter your email to receive a login link.
      </p>
      <form class="form" method="POST" action="{% url 'optimap:login_response' %}">
        {% csrf_token %}
        {% if request.GET.next %}
        <input type="hidden" name="next" value="{{ request.GET.next }}">
        {% endif %}
        <div class="form-group mb-2">
          <input
            id="email"
            placeholder="Email address"
            class="form-control form-control-sm"
            type="email"
            required=""
            name="email"
          />
        </div>
        <div class="form-group mb-2">
          <button type="submit" class="btn btn-primary btn-sm btn-block">Send login link</button>
        </div>
      </form>
      <p class="small text-muted mb-0">
        Want to stay <em>anonymous</em>? Use <a href="https://www.mailinator.com/" target="_blank">Mailinator</a> or check our <a href="{% url 'optimap:privacy' %}">privacy info</a>.
      </p>
    </li>
    {% endif %}
  </ul>
</li>
